<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>管理后台</title>
	<script type="text/javascript" src="/Public/js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="/Public/js/scripts/jquery/Validform_v5.3.2_min.js"></script>
    <script type="text/javascript" src="/Public/js/scripts/lhgdialog/lhgdialog.js?skin=idialog"></script>
	<script type="text/javascript" src="/Public/js/scripts/swfupload/swfupload.js"></script>
	<script type="text/javascript" src="/Public/js/scripts/datepicker/WdatePicker.js"></script>
	<script type="text/javascript" src="/Public/js/scripts/swfupload/swfupload.handlers.js"></script>
	<script type="text/javascript" charset="utf-8" src="/Public/js/scripts/kindeditor/kindeditor.js"></script>
	<script type="text/javascript" charset="utf-8" src="/Public/js/scripts/kindeditor/lang/zh_CN.js"></script>
    <script type="text/javascript" src="/Public/js/layout.js"></script>	
    <link href="/Public/admin/css/pagination.css" rel="stylesheet" type="text/css" />	
	<link href="/Public/admin/admin.css" rel="stylesheet" type="text/css" />
	<link href="/Public/admin/page.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="/Public/js/check.js"></script>
	<script type="text/javascript">
				 //初始化编辑器
        KindEditor.ready(function(K) {
                window.editor = K.create('#content');
        });
        KindEditor.ready(function(K) {
                K.create('#content', {
						uploadJson : '/Public/js/scripts/kindeditor/php/upload_json.php',
						fileManagerJson : '/Public/js/scripts/kindeditor/php/file_manager_json.php',
                        allowFileManager : true
                });
        });
	    $(function () {
	        //初始化表单验证
	        $("#form").initValidform();
			 //初始化上传控件
	        $(".upload-img").each(function () {
	            $(this).InitSWFUpload({ sendurl: "/Admin/Public/upload", flashurl: "/Public/js/scripts/swfupload/swfupload.swf" });
	        });
	        $(".upload-album").each(function () {
	            $(this).InitSWFUpload({ btntext: "批量上传", btnwidth: 66, single: false, water: true, thumbnail: true, filesize: "2048", sendurl: "/Admin/Public/upload", flashurl: "/Public/js/scripts/swfupload/swfupload.swf", filetypes: "*.jpg;*.jpge;*.png;*.gif;" });
	        });
	        $(".attach-btn").click(function () {
	            showAttachDialog();
	        });
	        //设置封面图片的样式
	        $(".photo-list ul li .img-box img").each(function () {
	            if ($(this).attr("src") == $("#hidFocusPhoto").val()) {
	                $(this).parent().addClass("selected");
	            }
	        });
			$("#ddlParentId").change(function(){
				$.get('/Admin/Shop/selectajax',{id:this.value},function(data){
					 var dataobj = eval("("+data+")");
					 $("#ddlParentId1").prev().find('span').html('请选择在市级单位');					 
					 $("#ddlParentId1").html(dataobj.str);
					 $("#ddlParentId1").prev().find('ul').html(dataobj.str1);
				});
			});
			$("#ddlParentId1").change(function(){
				$.get('/Admin/Shop/selectajax1',{id:this.value},function(data){
					 var dataobj = eval("("+data+")");
					 $("#ddlParentId2").prev().find('span').html('请选择在区县单位');					 
					 $("#ddlParentId2").html(dataobj.str);
					 $("#ddlParentId2").prev().find('ul').html(dataobj.str1);
				});
			});
			$("#ddlParentId3").change(function(){
				$.get('/Admin/Shop/selectajax3',{id:this.value},function(data){
					if(data == 0){
						$("#checkbox").html('<div class="boxwrap"></div>');
					}else{
						 var dataobj = eval("("+data+")");	
						 $("#checkbox").html('<div class="boxwrap"></div>');
						 $("#checkbox").find('div').html(dataobj.str1);
					 		$("#checkbox").append(dataobj.str);
					}				 
				});
			});

	    });
		function sel(obj){		
			$(obj).siblings().removeClass("selected");
            $(obj).addClass("selected"); //添加选中样式
            var indexNum = $(obj).index();
			var titObj = $(obj).parents('.boxwrap');
            var selectObj = $(obj).parents('.boxwrap').next();
            //selectObj.find("option").attr("selected", false);			
           // selectObj.find("option").eq(indexNum).attr("selected", true); //赋值给对应的option
		   selectObj.get(0).selectedIndex =$(obj).index();
            titObj.find("span").text($(obj).text()); //赋值选中值        
            selectObj.trigger("change"); 		
		}
		
		function checkb(obj){
			if($(obj).attr("class")=='selected'){
				$(obj).removeClass("selected");         	
			}else{
				$(obj).addClass("selected"); //添加选中样式
			}		
            var indexNum = $(obj).index();
			var titObj = $(obj).parents('.boxwrap');
            var selectObj = $(obj).parents('.boxwrap').siblings('label');
            //selectObj.find("option").attr("selected", false);			
           // selectObj.find("option").eq(indexNum).attr("selected", true); //赋值给对应的option
		  selectObj.eq(indexNum).trigger("click"); 
            //titObj.find("span").text($(obj).text()); //赋值选中值        
            	
		}
		
		function otable(str){
			if(str == 2){
				$('#otable').css('display','block');
			}else{
				$('#otable').css('display','none');
			}
		}
		
		function addtable(){
			$str = '<tr><td style="padding: 5px;"><input type="text" name="tab[]" style="width: 160px;height: 26px;text-align: center;"  /></td><td style="padding: 5px;"><input type="text" name="tab[]" style="width: 160px;height: 26px;text-align: center;"  /></td><td style="padding: 5px;"><input type="text" name="tab[]" style="width: 160px;height: 26px;text-align: center;"  /></td></tr>';
			$('#tab').append($str);
		}
		
		function deltable(){
			$("#tab tr:last").remove();
		}
	</script>
	<style>
		.x_a a{
			border: 1px solid #33b5e5;
			color: #333;
    		padding: 8px 16px;
			text-decoration:none;
		}
		.x_a a.active,.x_a a:hover{
			color:#fff;
			background: #33b5e5 ;
			border: 1px solid transparent;
		}
	
	</style>
</head>
<body class="mainbody">
    <form id="form1" method="get" name="form">
    <div>
        <!--导航栏-->
        <div class="location">
            <a href="javascript:history.back(-1);" class="back"><i></i><span>返回上一页</span></a>
            <a href="/Admin/Index/center" class="home"><i></i><span>首页</span></a> <i class="arrow">
            </i><span>订单列表</span>
        </div>
        <!--/导航栏-->
        <!--工具栏-->	
        <div class="toolbar-wrap">
            <div id="floatHead" class="toolbar">
                <div class="l-list">
                    <ul class="icon-list">
                    	<!--
                       <li><a class="add" href="{:U('/Admin/Order/add')}"><i></i><span> 新增订单</span></a></li>
					   
					    <if condition="$title eq ''"><li><a class="all" href="javascript:;" onclick="checkAll(this)"><i></i><span>全选</span></a></li><else /><li></if>       
                 		<if condition="$title eq ''"><li><a class="del" style="cursor:pointer;" id="btnDelete" onclick="return ExePostBack('Order')"><i></i><span>删除</span></a></li><else /><li></if>   
						-->
						<!--<li><a id="btnSave" Class="save"><i></i><span>保存</span></a></li>-->	
				    </ul>
					<div class="menu-list">
<p style="float:left;height:30px;line-height:30px;">　订单状态：</p>
					   <div class="rule-single-select single-select">
				          <select id="ddlProperty" name="verify" onchange="location='/Admin/Order/index/verify/'+options[selectedIndex].value">
				            <option Value=""  <if condition="$verify eq ''">selected="selected"</if>>全部</option>
				            <option Value="1" <if condition="$verify eq '1'">selected="selected"</if>>未付款</option>
				            <option Value="2" <if condition="$verify eq '2'">selected="selected"</if>>已付款</option>
							<option Value="3" <if condition="$verify eq '3'">selected="selected"</if>>已完成</option>
							<option Value="4" <if condition="$verify eq '4'">selected="selected"</if>>退　款</option>
				          </select>
				        </div>
					
					</div>
					<div class="menu-list">
		<p style="float:left;height:30px;line-height:30px;">　日期：</p>
		<div style="width: 190px" class="input-date">
		  <input type="text" value="{$Think.get.starttime}" name="starttime" id="txtAddTime" class="input date" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" datatype="/^\d{4}\-\d{1,2}\-\d{1,2}\s{1}(\d{1,2}:){2}\d{1,2}$/" errormsg="请选择正确的日期" sucmsg=" " /><!--datatype="/^\s*$|^\d{4}\-\d{1,2}\-\d{1,2}\s{1}(\d{1,2}:){2}\d{1,2}$/"-->
        <i>日期</i>
      </div>
	  --
	  <div style="width: 190px" class="input-date">
        <input type="text" name="stoptime" value="{$Think.get.stoptime}" id="txtAddTime" class="input date" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" datatype="/^\d{4}\-\d{1,2}\-\d{1,2}\s{1}(\d{1,2}:){2}\d{1,2}$/"  errormsg="请选择正确的日期" sucmsg=" "  />
        <i>日期</i>
      </div>
      				</div>
			    </div>
                <div class="r-list" style = "float: none;">
				
                	<p style="float:left;height:30px;line-height:30px;">　订单号：</p>
                    <input type="text" id="txtKeywords" value="{$Think.get.keyword}" class="keyword" name="keyword" />
                    <input type="submit" id="lbtnSearch" name="search" class="btn-search" value="查询" onclick="checkaction(1);" />

					
                </div>
				<div class="r-list">
					<input type="submit"  class="btn"  style="margin-left:10px;" value="导出" onclick="checkaction(0);"/>	
                </div>
            </div>
        </div>
        <!--/工具栏-->
		
		<!--文字列表-->
		<table width="100%" border="0" cellspacing="0" cellpadding="0" class="ltable">
		  <tr>
		    <th width="15%">订单号</th>
			<th align="center" width="10%">用户手机号</th>
			<th align="center" width="8%">商品总价</th>
			<th align="center" width="13%">优惠券</th>
			<th align="center" width="8%">运费</th>		
			<th align="center" width="8%">实际支付金额</th>
			<th align="center" width="8%">返利金额</th>	
			<th align="center" width="12%">下单时间</th>
			<th align="center" width="8%">状态</th>
		   <th align="center" width="">操作</th>
		  </tr>
		<if condition="$data" >
			<volist name="data" id="val">
			  <tr>
			    <td align="center">{$val.orderid}</td>
				<td align="center">{$val.phone}</td>
				<td align="center">{$val.price}</td>			
				<td align="center">
					<if condition="$val['coupons']">
					{$val.title} 满 {$val.man} 减 {$val.jian}
					<else />
					未使用优惠券
					</if>
				</td>
				<td align="center">
					<if condition="$val['ems'] neq 0">
					{$val.ems}
					<else />
					包邮
					</if>
				</td>
				<td align="center">{$val.prices}</td>
				<td align="center">{$val['two_distribution']+$val['three_distribution'] | }</td>
				<td align="center">{$val.addtime|date = "Y-m-d H:i:s",###}</td>
				<td align="center">
				<if condition="$val.state eq 1">
					未付款
				<elseif condition="$val.state eq 2 and $val.status eq 1" />
					已付款
				<elseif condition="$val.state eq 3" />
					已完成
				</if>
				
				<if condition="$val.status eq 1 and $val.state eq 2">
					等待发货
				<elseif condition="$val.status eq 2 and $val.state eq 2" />
					已发货
				<elseif condition="$val.status eq 3" />
					申请退款
				<elseif condition="$val.status eq 4" />
					已退款
				</if>
				</td>
			    <td align="center">

					[<a href="/Admin/Order/edit/id/{$val.id}">订单查询</a>] 
					[<a href="/Admin/Order/state/id/{$val.id}/state/2">购物清单</a>]

				</td>
			  </tr>
		  	</volist>
		<else />
			<tr><td align="center" colspan="10">暂无记录</td></tr>
		</if>
		</table>
		<!--/文字列表-->
        <!--内容底部-->
        <div class="line20">
        </div>
        <div class="pagelist">
            <div class="flickr">
                {$page}
            </div>
        </div>
        <!--/内容底部-->
    </div>
    </form>
</body>
 <script>
function checkaction(v){ 
	if(v==0){ 
	document.form.action="{:U('admin/order/export')}"; 
	}else{ 
	document.form.action="{:U('admin/order/index')}"; 
	} 
	form.submit(); 
} 

$(function(){
    //搜索订单
    $("#search").click(function(){
        $("#anu").val('apply/admin');
        $("#form1").submit();
    });
    //导出订单
    $("#export").click(function(){
        $("#anu").val('apply/admin/export');
        $("#form1").submit();
    });
 });
</script>  
</html>
